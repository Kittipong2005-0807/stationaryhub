# ЁЯУз р╕гр╕░р╕Ър╕Ър╕нр╕╡р╣Ар╕бр╕ер╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щ - StationaryHub

## ЁЯФД Flow р╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щр╕Вр╕нр╕Зр╕гр╕░р╕Ър╕Ър╕нр╕╡р╣Ар╕бр╕е

### 1я╕ПтГг **р╣Ар╕бр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╕кр╣Ир╕Зр╕Др╕│р╕Вр╕нр╣Ар╕Ър╕┤р╕Бр╣Гр╕лр╕бр╣И**

```
ЁЯСд User р╕кр╣Ир╕Зр╕Др╕│р╕Вр╕нр╣Ар╕Ър╕┤р╕Б
    тЖУ
ЁЯФФ р╣Ар╕гр╕╡р╕вр╕Б notifyRequisitionCreated()
    тЖУ
ЁЯУз р╕кр╣Ир╕Зр╕нр╕╡р╣Ар╕бр╕е "Requisition Created" тЖТ ЁЯСд User (р╕Ьр╕╣р╣Йр╕кр╣Ир╕Зр╕Др╕│р╕Вр╕н)
    тЖУ
ЁЯФН р╕лр╕▓ Manager р╣Гр╕Щ CostCenter р╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Щ
    тЖУ
ЁЯУз р╕кр╣Ир╕Зр╕нр╕╡р╣Ар╕бр╕е "Requisition Pending" тЖТ ЁЯСитАНЁЯТ╝ Manager
    тЖУ
тЭМ р╣Др╕бр╣Ир╕кр╣Ир╕Зр╕лр╕▓ Admin р╣Ар╕ер╕в
```

**р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф:**
- **р╕кр╣Ир╕Зр╣Гр╕лр╣Й User**: р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Бр╕▓р╕гр╕кр╣Ир╕Зр╕Др╕│р╕Вр╕нр╣Ар╕Ър╕┤р╕Б р╕Юр╕гр╣Йр╕нр╕бр╕гр╕▓р╕вр╕Бр╕▓р╕гр╕кр╕┤р╕Щр╕Др╣Йр╕▓
- **р╕кр╣Ир╕Зр╣Гр╕лр╣Й Manager**: р╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щр╕бр╕╡р╕Др╕│р╕Вр╕нр╣Гр╕лр╕бр╣Ир╕гр╕нр╕Бр╕▓р╕гр╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤
- **р╣Др╕бр╣Ир╕кр╣Ир╕Зр╣Гр╕лр╣Й Admin**: Admin р╕Ир╕░р╣Др╕бр╣Ир╣Др╕Фр╣Йр╕гр╕▒р╕Ър╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щр╕Хр╕нр╕Щр╕кр╣Ир╕Зр╕Др╕│р╕Вр╕нр╣Ар╕Ър╕┤р╕Бр╣Гр╕лр╕бр╣И

---

### 2я╕ПтГг **р╣Ар╕бр╕╖р╣Ир╕н Manager р╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤р╕Др╕│р╕Вр╕н**

```
ЁЯСитАНЁЯТ╝ Manager р╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤р╕Др╕│р╕Вр╕н
    тЖУ
ЁЯФФ р╣Ар╕гр╕╡р╕вр╕Б notifyRequisitionApproved()
    тЖУ
ЁЯУз р╕кр╣Ир╕Зр╕нр╕╡р╣Ар╕бр╕е "Requisition Approved" тЖТ ЁЯСд User (р╕Ьр╕╣р╣Йр╕кр╣Ир╕Зр╕Др╕│р╕Вр╕н)
    тЖУ
ЁЯУз р╕кр╣Ир╕Зр╕нр╕╡р╣Ар╕бр╕е "Requisition Approved Admin" тЖТ ЁЯСитАНЁЯТ╗ Admin
```

**р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф:**
- **р╕кр╣Ир╕Зр╣Гр╕лр╣Й User**: р╣Бр╕Ир╣Йр╕Зр╕Бр╕▓р╕гр╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤
- **р╕кр╣Ир╕Зр╣Гр╕лр╣Й Admin**: р╣Бр╕Ир╣Йр╕Зр╕зр╣Ир╕▓р╕бр╕╡р╕Бр╕▓р╕гр╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤р╕Др╕│р╕Вр╕нр╣Гр╕лр╕бр╣И

---

### 3я╕ПтГг **р╣Ар╕бр╕╖р╣Ир╕н Manager р╕Ыр╕Пр╕┤р╣Ар╕кр╕Шр╕Др╕│р╕Вр╕н**

```
ЁЯСитАНЁЯТ╝ Manager р╕Ыр╕Пр╕┤р╣Ар╕кр╕Шр╕Др╕│р╕Вр╕н
    тЖУ
ЁЯФФ р╣Ар╕гр╕╡р╕вр╕Б notifyRequisitionRejected()
    тЖУ
ЁЯУз р╕кр╣Ир╕Зр╕нр╕╡р╣Ар╕бр╕е "Requisition Rejected" тЖТ ЁЯСд User (р╕Ьр╕╣р╣Йр╕кр╣Ир╕Зр╕Др╕│р╕Вр╕н)
```

**р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф:**
- **р╕кр╣Ир╕Зр╣Гр╕лр╣Й User**: р╣Бр╕Ир╣Йр╕Зр╕Бр╕▓р╕гр╕Ыр╕Пр╕┤р╣Ар╕кр╕Шр╕Юр╕гр╣Йр╕нр╕бр╣Ар╕лр╕Хр╕╕р╕Ьр╕е

---

### 4я╕ПтГг **р╣Ар╕бр╕╖р╣Ир╕нр╣Др╕бр╣Ир╕Юр╕Ъ Manager**

```
ЁЯСд User р╕кр╣Ир╕Зр╕Др╕│р╕Вр╕нр╣Ар╕Ър╕┤р╕Б
    тЖУ
ЁЯФН р╕лр╕▓ Manager р╣Гр╕Щ CostCenter р╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Щ
    тЖУ
тЭМ р╣Др╕бр╣Ир╕Юр╕Ъ Manager
    тЖУ
ЁЯУз р╕кр╣Ир╕Зр╕нр╕╡р╣Ар╕бр╕е "No Manager Found" тЖТ ЁЯСитАНЁЯТ╗ Admin
```

**р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф:**
- **р╕кр╣Ир╕Зр╣Гр╕лр╣Й Admin**: р╣Бр╕Ир╣Йр╕Зр╕зр╣Ир╕▓р╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╣Др╕бр╣Ир╕бр╕╡ Manager р╕Бр╕│р╕лр╕Щр╕Фр╣Др╕зр╣Й

---

## ЁЯУЛ р╕кр╕гр╕╕р╕Ыр╕Бр╕▓р╕гр╕кр╣Ир╕Зр╕нр╕╡р╣Ар╕бр╕ер╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф

| р╣Ар╕лр╕Хр╕╕р╕Бр╕▓р╕гр╕Ур╣М | р╕кр╣Ир╕Зр╣Гр╕лр╣Йр╣Гр╕Др╕г | р╕Ыр╕гр╕░р╣Ар╕ар╕Чр╕нр╕╡р╣Ар╕бр╕е | р╕лр╕▒р╕зр╕Вр╣Йр╕н |
|-----------|-----------|-------------|--------|
| р╕кр╣Ир╕Зр╕Др╕│р╕Вр╕нр╣Ар╕Ър╕┤р╕Б | User | Requisition Created | р╕Др╕│р╕Вр╕нр╣Ар╕Ър╕┤р╕Бр╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕кр╣Ир╕Зр╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕вр╣Бр╕ер╣Йр╕з |
| р╕кр╣Ир╕Зр╕Др╕│р╕Вр╕нр╣Ар╕Ър╕┤р╕Б | Manager | Requisition Pending | р╕бр╕╡р╕Др╕│р╕Вр╕нр╣Ар╕Ър╕┤р╕Бр╣Гр╕лр╕бр╣Ир╕гр╕нр╕Бр╕▓р╕гр╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤ |
| р╕кр╣Ир╕Зр╕Др╕│р╕Вр╕нр╣Ар╕Ър╕┤р╕Б | Admin | тЭМ р╣Др╕бр╣Ир╕кр╣Ир╕З | - |
| р╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤р╕Др╕│р╕Вр╕н | User | Requisition Approved | р╕Др╕│р╕Вр╕нр╣Ар╕Ър╕┤р╕Бр╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤ |
| р╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤р╕Др╕│р╕Вр╕н | Admin | Requisition Approved Admin | р╕бр╕╡р╕Бр╕▓р╕гр╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤р╕Др╕│р╕Вр╕нр╣Ар╕Ър╕┤р╕Бр╣Гр╕лр╕бр╣И |
| р╕Ыр╕Пр╕┤р╣Ар╕кр╕Шр╕Др╕│р╕Вр╕н | User | Requisition Rejected | р╕Др╕│р╕Вр╕нр╣Ар╕Ър╕┤р╕Бр╕Цр╕╣р╕Бр╕Ыр╕Пр╕┤р╣Ар╕кр╕Ш |
| р╣Др╕бр╣Ир╕Юр╕Ъ Manager | Admin | No Manager Found | р╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╣Бр╕Ьр╕Щр╕Бр╣Др╕бр╣Ир╕Юр╕ЪManager |

---

## ЁЯФН р╕Бр╕▓р╕гр╕лр╕▓ Manager

### р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Бр╕▓р╕гр╕лр╕▓ Manager:

1. **р╕Фр╕╢р╕З CostCenter р╕Вр╕нр╕З User**:
   ```sql
   SELECT costcentercode FROM UserWithRoles WHERE EmpCode = 'USER_ID'
   ```

2. **р╕лр╕▓ Manager р╣Гр╕Щ CostCenter р╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Щ**:
   ```sql
   SELECT L2, CurrentEmail, FullNameEng FROM VS_DivisionMgr 
   WHERE CostCenter = 'USER_COSTCENTER'
   ```

3. **р╕кр╣Ир╕Зр╕нр╕╡р╣Ар╕бр╕ер╣Гр╕лр╣Й Manager р╕Чр╕╡р╣Ир╕Юр╕Ъ**

### р╕Бр╕гр╕Ур╕╡р╕Юр╕┤р╣Ар╕ир╕й:

- **р╕Цр╣Йр╕▓ User р╣Ар╕Ыр╣Зр╕Щ Manager**: р╣Др╕бр╣Ир╕кр╣Ир╕Зр╕нр╕╡р╣Ар╕бр╕ер╣Гр╕Др╕г (р╕кр╕▓р╕бр╕▓р╕гр╕Цр╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤р╕Хр╕▒р╕зр╣Ар╕нр╕Зр╣Др╕Фр╣Й)
- **р╕Цр╣Йр╕▓р╣Др╕бр╣Ир╕Юр╕Ъ Manager**: р╕кр╣Ир╕Зр╕нр╕╡р╣Ар╕бр╕ер╣Гр╕лр╣Й Admin р╣Бр╕Чр╕Щ

---

## ЁЯУз р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Фр╕нр╕╡р╣Ар╕бр╕ер╣Бр╕Хр╣Ир╕ер╕░р╕Ыр╕гр╕░р╣Ар╕ар╕Ч

### 1. **Requisition Created** (р╕кр╣Ир╕Зр╣Гр╕лр╣Й User)
- р╣Ар╕ер╕Вр╕Чр╕╡р╣Ир╕Др╕│р╕Вр╕н
- р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕Вр╕нр╣Ар╕Ър╕┤р╕Б
- р╕Ир╕│р╕Щр╕зр╕Щр╣Ар╕Зр╕┤р╕Щ
- р╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╣Бр╕ер╕░р╣Ар╕зр╕ер╕▓р╕кр╣Ир╕З
- р╕гр╕▓р╕вр╕Бр╕▓р╕гр╕кр╕┤р╕Щр╕Др╣Йр╕▓р╕Др╕гр╕Ър╕Цр╣Йр╕зр╕Щ
- р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Хр╣Ир╕нр╣Др╕Ы
- р╕ер╕┤р╕Зр╕Бр╣Мр╕Фр╕╣р╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Др╕│р╕Вр╕нр╣Ар╕Ър╕┤р╕Б

### 2. **Requisition Pending** (р╕кр╣Ир╕Зр╣Гр╕лр╣Й Manager)
- р╣Ар╕ер╕Вр╕Чр╕╡р╣Ир╕Др╕│р╕Вр╕н
- р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕Вр╕нр╣Ар╕Ър╕┤р╕Б
- р╕Кр╕╖р╣Ир╕н Manager
- р╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╣Бр╕ер╕░р╣Ар╕зр╕ер╕▓р╕кр╣Ир╕З
- р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Хр╣Ир╕нр╣Др╕Ы
- р╕ер╕┤р╕Зр╕Бр╣Мр╕Фр╕╣р╕Др╕│р╕Вр╕нр╣Ар╕Ър╕┤р╕Б

### 3. **Requisition Approved** (р╕кр╣Ир╕Зр╣Гр╕лр╣Й User)
- р╣Ар╕ер╕Вр╕Чр╕╡р╣Ир╕Др╕│р╕Вр╕н
- р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤
- р╕кр╕Цр╕▓р╕Щр╕░р╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤

### 4. **Requisition Rejected** (р╕кр╣Ир╕Зр╣Гр╕лр╣Й User)
- р╣Ар╕ер╕Вр╕Чр╕╡р╣Ир╕Др╕│р╕Вр╕н
- р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤
- р╣Ар╕лр╕Хр╕╕р╕Ьр╕ер╕Бр╕▓р╕гр╕Ыр╕Пр╕┤р╣Ар╕кр╕Ш

### 5. **Requisition Approved Admin** (р╕кр╣Ир╕Зр╣Гр╕лр╣Й Admin)
- р╣Ар╕ер╕Вр╕Чр╕╡р╣Ир╕Др╕│р╕Вр╕н
- р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕Вр╕нр╣Ар╕Ър╕┤р╕Б
- р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤
- р╕Ир╕│р╕Щр╕зр╕Щр╣Ар╕Зр╕┤р╕Щ
- р╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕кр╣Ир╕З
- р╕кр╕Цр╕▓р╕Щр╕░р╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤

### 6. **No Manager Found** (р╕кр╣Ир╕Зр╣Гр╕лр╣Й Admin)
- р╣Ар╕ер╕Вр╕Чр╕╡р╣Ир╕Др╕│р╕Вр╕н
- р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕Вр╕нр╣Ар╕Ър╕┤р╕Б
- CostCenter
- р╕Др╕│р╣Бр╕Щр╕░р╕Щр╕│р╕Бр╕▓р╕гр╣Бр╕Бр╣Йр╣Др╕В
- р╕ер╕┤р╕Зр╕Бр╣Мр╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Др╕│р╕Вр╕нр╣Ар╕Ър╕┤р╕Б

---

## тЪЩя╕П р╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╕Чр╕╡р╣Ир╕Ир╕│р╣Ар╕Ыр╣Зр╕Щ

### Environment Variables:
- `SMTP_HOST`: р╣Ар╕Лр╕┤р╕гр╣Мр╕Яр╣Ар╕зр╕нр╕гр╣М SMTP
- `SMTP_PORT`: р╕Юр╕нр╕гр╣Мр╕Х SMTP
- `SMTP_USER`: р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й SMTP
- `SMTP_PASS`: р╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ SMTP
- `SMTP_FROM`: р╕нр╕╡р╣Ар╕бр╕ер╕Ьр╕╣р╣Йр╕кр╣Ир╕З
- `NEXT_PUBLIC_APP_URL`: URL р╕Вр╕нр╕Зр╕гр╕░р╕Ър╕Ъ

### р╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕е:
- р╕Хр╕▓р╕гр╕▓р╕З `UserWithRoles`: р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Юр╕Щр╕▒р╕Бр╕Зр╕▓р╕Щр╣Бр╕ер╕░ CostCenter
- р╕Хр╕▓р╕гр╕▓р╕З `CostCenters`: р╕Вр╣Йр╕нр╕бр╕╣р╕е Manager р╣Бр╕ер╕░ CostCenter
- View `VS_DivisionMgr`: р╕гр╕зр╕бр╕Вр╣Йр╕нр╕бр╕╣р╕е Manager
- р╕Хр╕▓р╕гр╕▓р╕З `EMAIL_LOGS`: р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Бр╕▓р╕гр╕кр╣Ир╕Зр╕нр╕╡р╣Ар╕бр╕е

---

## ЁЯФз р╕Бр╕▓р╕гр╕Ир╕▒р╕Фр╕Бр╕▓р╕г Error

### р╣Ар╕бр╕╖р╣Ир╕нр╕кр╣Ир╕Зр╕нр╕╡р╣Ар╕бр╕ер╣Др╕бр╣Ир╕кр╕│р╣Ар╕гр╣Зр╕И:
1. р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕кр╕Цр╕▓р╕Щр╕░ `FAILED` р╣Гр╕Щ `EMAIL_LOGS`
2. р╕Ър╕▒р╕Щр╕Чр╕╢р╕Б Error Message
3. р╣Ар╕Юр╕┤р╣Ир╕б `RETRY_COUNT`
4. р╕кр╕▓р╕бр╕▓р╕гр╕Цр╕ер╕нр╕Зр╕кр╣Ир╕Зр╣Гр╕лр╕бр╣Ир╣Др╕Фр╣Й

### р╕Бр╕▓р╕г Retry:
- р╕гр╕░р╕Ър╕Ър╕кр╕▓р╕бр╕▓р╕гр╕Цр╕ер╕нр╕Зр╕кр╣Ир╕Зр╕нр╕╡р╣Ар╕бр╕ер╕Чр╕╡р╣Ир╕ер╣Йр╕бр╣Ар╕лр╕ер╕зр╣Гр╕лр╕бр╣Ир╣Др╕Фр╣Й
- р╕бр╕╡р╕Бр╕▓р╕гр╕Ир╕│р╕Бр╕▒р╕Фр╕Ир╕│р╕Щр╕зр╕Щр╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣Ир╕ер╕нр╕Зр╕кр╣Ир╕З
- р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤р╕Бр╕▓р╕гр╕ер╕нр╕Зр╕кр╣Ир╕З

---

## ЁЯУК р╕Бр╕▓р╕гр╕Хр╕┤р╕Фр╕Хр╕▓р╕б

### Logs р╕Чр╕╡р╣Ир╕Ър╕▒р╕Щр╕Чр╕╢р╕Б:
- р╕Бр╕▓р╕гр╕кр╣Ир╕Зр╕нр╕╡р╣Ар╕бр╕ер╣Бр╕Хр╣Ир╕ер╕░р╕Др╕гр╕▒р╣Йр╕З
- р╕кр╕Цр╕▓р╕Щр╕░р╕Бр╕▓р╕гр╕кр╣Ир╕З (SENT/FAILED/PENDING)
- Message ID р╕Ир╕▓р╕Б SMTP
- Error Message (р╕Цр╣Йр╕▓р╕бр╕╡)
- р╕Вр╕Щр╕▓р╕Фр╕нр╕╡р╣Ар╕бр╕е
- р╕Ир╕│р╕Щр╕зр╕Щр╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣Ир╕ер╕нр╕Зр╕кр╣Ир╕З

### р╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ:
- р╕Фр╕╣ `EMAIL_LOGS` р╣Ар╕Юр╕╖р╣Ир╕нр╕Хр╕┤р╕Фр╕Хр╕▓р╕бр╕Бр╕▓р╕гр╕кр╣Ир╕З
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Console Logs
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ SMTP Settings
