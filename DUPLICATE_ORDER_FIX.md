# üîÑ ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á Order ‡∏ã‡πâ‡∏≥

## üö´ **‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô**

### **‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤**
- ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "Submit Requisition" ‡∏à‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á Order 2 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á
- ‡πÄ‡∏Å‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô
- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô

### **‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏Ç‡∏≠‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤**
1. **‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô**: 
   - ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å: ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `/api/orgcode3` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á requisition
   - ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á: ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `/api/requisitions` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á requisition items ‡πÅ‡∏ï‡πà API ‡∏ô‡∏µ‡πâ‡∏°‡∏µ logic ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á requisition ‡πÉ‡∏´‡∏°‡πà‡∏î‡πâ‡∏ß‡∏¢

2. **Logic ‡πÉ‡∏ô API `/api/requisitions` ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á**:
   - ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á `requisitionId` ‡πÑ‡∏õ API ‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á requisition items
   - ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ `requisitionId` ‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á requisition ‡πÉ‡∏´‡∏°‡πà

## ‚úÖ **‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç**

### **1. ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á OrgCode3Service**

```typescript
// ‡πÄ‡∏û‡∏¥‡πà‡∏° parameter items ‡πÉ‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô createRequisitionWithSiteId
static async createRequisitionWithSiteId(
  userId: string,
  totalAmount: number,
  issueNote?: string,
  siteId?: string,
  items?: Array<{
    PRODUCT_ID: number
    QUANTITY: number
    UNIT_PRICE: number
    TOTAL_PRICE: number
  }>
): Promise<number | null>
```

### **2. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á Requisition Items ‡πÉ‡∏ô OrgCode3Service**

```typescript
// ‡∏™‡∏£‡πâ‡∏≤‡∏á requisition items ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
if (finalRequisitionId && items && items.length > 0) {
  console.log(`Creating ${items.length} requisition items for requisition ${finalRequisitionId}`)
  
  for (const item of items) {
    await prisma.rEQUISITION_ITEMS.create({
      data: {
        REQUISITION_ID: finalRequisitionId,
        PRODUCT_ID: item.PRODUCT_ID,
        QUANTITY: item.QUANTITY,
        UNIT_PRICE: item.UNIT_PRICE,
        TOTAL_PRICE: item.TOTAL_PRICE,
      }
    })
  }
  
  console.log(`‚úÖ Created ${items.length} requisition items`)
}
```

### **3. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï API `/api/orgcode3`**

```typescript
// ‡∏™‡πà‡∏á REQUISITION_ITEMS ‡πÑ‡∏õ‡∏¢‡∏±‡∏á OrgCode3Service
const requisitionId = await OrgCode3Service.createRequisitionWithSiteId(
  userId,
  totalAmount,
  issueNote,
  siteId,
  REQUISITION_ITEMS  // ‡πÄ‡∏û‡∏¥‡πà‡∏° parameter ‡∏ô‡∏µ‡πâ
)
```

### **4. ‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API `/api/requisitions` ‡∏ã‡πâ‡∏≥**

```typescript
// ‡∏•‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å app/cart/page.tsx ‡πÅ‡∏•‡∏∞ app/manager/cart/page.tsx
// ‡∏™‡∏£‡πâ‡∏≤‡∏á requisition items
if (result.requisitionId && requisitionData.REQUISITION_ITEMS.length > 0) {
  const itemsRes = await fetch("/stationaryhub/api/requisitions", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      ...requisitionData,
      requisitionId: result.requisitionId
    }),
  })
  
  if (!itemsRes.ok) {
    console.warn("Failed to create requisition items")
  }
}
```

### **5. ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á API `/api/requisitions`**

```typescript
// ‡πÄ‡∏û‡∏¥‡πà‡∏° return statement ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á requisition items
if (data.requisitionId) {
  console.log("Creating requisition items for existing ID:", data.requisitionId)
  
  if (data.REQUISITION_ITEMS && Array.isArray(data.REQUISITION_ITEMS)) {
    for (const item of data.REQUISITION_ITEMS) {
      await prisma.rEQUISITION_ITEMS.create({
        data: {
          REQUISITION_ID: data.requisitionId,
          PRODUCT_ID: item.PRODUCT_ID,
          QUANTITY: item.QUANTITY,
          UNIT_PRICE: item.UNIT_PRICE,
        }
      })
    }
  }
  
  return NextResponse.json({ success: true }, { status: 201 })  // ‡πÄ‡∏û‡∏¥‡πà‡∏° return ‡∏ô‡∏µ‡πâ
}
```

## üîß **‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç**

### **‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç**:
1. **`lib/orgcode3-service.ts`**: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á requisition items
2. **`app/api/orgcode3/route.ts`**: ‡∏™‡πà‡∏á items ‡πÑ‡∏õ‡∏¢‡∏±‡∏á OrgCode3Service
3. **`app/cart/page.tsx`**: ‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏ã‡πâ‡∏≥
4. **`app/manager/cart/page.tsx`**: ‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏ã‡πâ‡∏≥
5. **`app/api/requisitions/route.ts`**: ‡πÄ‡∏û‡∏¥‡πà‡∏° return statement

## üß™ **‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö**

### **‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö**
1. ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ user account
2. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
3. ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "Submit Requisition"
4. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡πà‡∏≤‡∏°‡∏µ requisition ‡πÄ‡∏û‡∏µ‡∏¢‡∏á 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
5. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ requisition items ‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô

### **‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á**
- ‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á requisition ‡πÄ‡∏û‡∏µ‡∏¢‡∏á 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
- ‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á requisition items ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô
- ‚úÖ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô
- ‚úÖ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡πâ‡∏≥‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

## üìù **‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏**

- ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á requisition ‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô
- ‡∏•‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
- ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡πâ‡∏≥‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
- ‡πÉ‡∏ä‡πâ transaction ‡πÉ‡∏ô OrgCode3Service ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

## üéØ **‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå**

‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß:
- ‚úÖ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á Order ‡∏ã‡πâ‡∏≥
- ‚úÖ ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á requisition ‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô
- ‚úÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥
- ‚úÖ ‡∏•‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô

