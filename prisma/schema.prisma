generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["views"]
}

datasource db {
  provider = "sqlserver"
  url      = env("DATABASE_URL")
}

model APPROVALS {
  APPROVAL_ID    Int          @id(map: "PK__APPROVAL__6B47F41C06E15807") @default(autoincrement())
  REQUISITION_ID Int
  APPROVED_BY    String       @db.VarChar(50)
  STATUS         String?      @db.VarChar(50)
  APPROVED_AT    DateTime?    @default(now(), map: "DF__APPROVALS__APPRO__5070F446") @db.DateTime
  NOTE           String?      @db.VarChar(1000)
  USERS          USERS        @relation(fields: [APPROVED_BY], references: [USER_ID], onUpdate: NoAction, map: "FK__APPROVALS__APPRO__52593CB8")
  REQUISITIONS   REQUISITIONS @relation(fields: [REQUISITION_ID], references: [REQUISITION_ID], onUpdate: NoAction, map: "FK__APPROVALS__REQUI__5165187F")
}

model EMAIL_LOGS {
  EMAIL_ID         Int       @id(map: "PK__EMAIL_LO__6BB22C4DBF0B4DFB") @default(autoincrement())
  TO_USER_ID       String    @db.VarChar(50)
  SUBJECT          String?   @db.VarChar(255)
  BODY             String?   @db.Text
  SENT_AT          DateTime? @default(now(), map: "DF__EMAIL_LOG__SENT___5AEE82B9") @db.DateTime
  STATUS           String?   @db.VarChar(50)
  IS_READ          Boolean?  @default(false, map: "DF__EMAIL_LOG__IS_RE__0D44F85C")
  FROM_EMAIL       String?   @db.VarChar(255)
  TO_EMAIL         String?   @db.VarChar(255)
  CC_EMAIL         String?   @db.VarChar(500)
  BCC_EMAIL        String?   @db.VarChar(500)
  EMAIL_TYPE       String?   @db.VarChar(50)
  MESSAGE_ID       String?   @db.VarChar(255)
  REPLY_TO         String?   @db.VarChar(255)
  PRIORITY         String?   @default("medium", map: "DF__EMAIL_LOG__PRIOR__7167D3BD") @db.VarChar(20)
  DELIVERY_STATUS  String?   @db.VarChar(50)
  ERROR_MESSAGE    String?   @db.Text
  RETRY_COUNT      Int?      @default(0, map: "DF__EMAIL_LOG__RETRY__725BF7F6")
  EMAIL_SIZE       BigInt?
  ATTACHMENT_COUNT Int?      @default(0, map: "DF__EMAIL_LOG__ATTAC__73501C2F")
  CREATED_BY       String?   @db.VarChar(50)
  UPDATED_AT       DateTime? @default(now(), map: "DF__EMAIL_LOG__UPDAT__74444068") @db.DateTime
  USERS            USERS     @relation(fields: [TO_USER_ID], references: [USER_ID], onUpdate: NoAction, map: "FK__EMAIL_LOG__TO_US__5CD6CB2B")

  @@index([IS_READ], map: "IX_EMAIL_LOGS_IS_READ")
  @@index([EMAIL_TYPE], map: "IX_EMAIL_LOGS_EMAIL_TYPE")
  @@index([FROM_EMAIL], map: "IX_EMAIL_LOGS_FROM_EMAIL")
  @@index([SENT_AT], map: "IX_EMAIL_LOGS_SENT_AT")
  @@index([TO_EMAIL], map: "IX_EMAIL_LOGS_TO_EMAIL")
}

model EMAIL_SETTINGS {
  ID                      Int      @id(map: "PK__EMAIL_SE__3214EC27A287C77C") @default(autoincrement())
  ENABLED                 Boolean  @default(true, map: "DF__EMAIL_SET__ENABL__56B3DD81")
  SCHEDULE_HOUR           Int      @default(10, map: "DF__EMAIL_SET__SCHED__57A801BA")
  SCHEDULE_MINUTE         Int      @default(0, map: "DF__EMAIL_SET__SCHED__589C25F3")
  TIMEZONE                String   @default("Asia/Bangkok", map: "DF__EMAIL_SET__TIMEZ__59904A2C") @db.NVarChar(50)
  FREQUENCY               String   @default("daily", map: "DF__EMAIL_SET__FREQU__5A846E65") @db.NVarChar(20)
  MIN_DAYS_PENDING        Int      @default(1, map: "DF__EMAIL_SET__MIN_D__5B78929E")
  MAX_DAYS_PENDING        Int      @default(30, map: "DF__EMAIL_SET__MAX_D__5C6CB6D7")
  MANAGER_EMAILS          String?  @db.NVarChar(Max)
  ADMIN_EMAILS            String?  @db.NVarChar(Max)
  CUSTOM_EMAILS           String?  @db.NVarChar(Max)
  EMAIL_SUBJECT           String?  @db.NVarChar(255)
  HEADER_COLOR            String?  @db.NVarChar(20)
  URGENCY_LEVEL           String?  @db.NVarChar(20)
  INCLUDE_PRODUCT_DETAILS Boolean  @default(true, map: "DF__EMAIL_SET__INCLU__5D60DB10")
  INCLUDE_REQUESTER_INFO  Boolean  @default(true, map: "DF__EMAIL_SET__INCLU__5E54FF49")
  CUSTOM_MESSAGE          String?  @db.NVarChar(Max)
  CREATED_DATE            DateTime @default(now(), map: "DF__EMAIL_SET__CREAT__5F492382")
  UPDATED_DATE            DateTime @default(now(), map: "DF__EMAIL_SET__UPDAT__603D47BB")
}

model EXPORT_LOGS {
  EXPORT_ID      Int          @id(map: "PK__EXPORT_L__A3B8D619CDEA586B") @default(autoincrement())
  REQUISITION_ID Int
  EXPORTED_BY    String       @db.VarChar(50)
  FILE_TYPE      String?      @db.VarChar(50)
  EXPORTED_AT    DateTime?    @default(now(), map: "DF__EXPORT_LO__EXPOR__5629CD9C") @db.DateTime
  USERS          USERS        @relation(fields: [EXPORTED_BY], references: [USER_ID], onUpdate: NoAction, map: "FK__EXPORT_LO__EXPOR__5812160E")
  REQUISITIONS   REQUISITIONS @relation(fields: [REQUISITION_ID], references: [REQUISITION_ID], onUpdate: NoAction, map: "FK__EXPORT_LO__REQUI__571DF1D5")
}

model PRICE_HISTORY {
  HISTORY_ID        Int      @id @default(autoincrement())
  PRODUCT_ID        Int
  OLD_PRICE         Decimal? @db.Decimal(18, 2)
  NEW_PRICE         Decimal? @db.Decimal(18, 2)
  PRICE_CHANGE      Decimal? @db.Decimal(18, 2)
  PERCENTAGE_CHANGE Decimal? @db.Decimal(5, 2)
  YEAR              Int
  RECORDED_DATE     DateTime @default(now())
  NOTES             String?  @db.VarChar(1000)
  CREATED_BY        String?  @db.VarChar(50)
  PRODUCTS          PRODUCTS @relation(fields: [PRODUCT_ID], references: [PRODUCT_ID], onUpdate: NoAction)
}

model PRODUCT_AUDIT_LOG {
  AUDIT_ID    Int       @id(map: "PK__PRODUCT___CDFE7087CD949D00") @default(autoincrement())
  PRODUCT_ID  Int?
  ACTION_TYPE String    @db.VarChar(20)
  OLD_DATA    String?   @db.Text
  NEW_DATA    String?   @db.Text
  CHANGED_BY  String    @db.VarChar(50)
  CHANGED_AT  DateTime? @default(now(), map: "DF__PRODUCT_A__CHANG__640DD89F") @db.DateTime
  IP_ADDRESS  String?   @db.VarChar(45)
  USER_AGENT  String?   @db.VarChar(500)
  NOTES       String?   @db.VarChar(1000)
  USERS       USERS     @relation(fields: [CHANGED_BY], references: [USER_ID], onUpdate: NoAction, map: "FK_PRODUCT_AUDIT_LOG_CHANGED_BY")
  PRODUCTS    PRODUCTS? @relation(fields: [PRODUCT_ID], references: [PRODUCT_ID], onUpdate: NoAction, map: "FK_PRODUCT_AUDIT_LOG_PRODUCT_ID")

  @@index([ACTION_TYPE], map: "IX_PRODUCT_AUDIT_LOG_ACTION_TYPE")
  @@index([CHANGED_AT], map: "IX_PRODUCT_AUDIT_LOG_CHANGED_AT")
  @@index([CHANGED_BY], map: "IX_PRODUCT_AUDIT_LOG_CHANGED_BY")
  @@index([PRODUCT_ID], map: "IX_PRODUCT_AUDIT_LOG_PRODUCT_ID")
}

model PRODUCT_CATEGORIES {
  CATEGORY_ID   Int        @id(map: "PK__PRODUCT___E7DA297C64E80E18") @default(autoincrement())
  CATEGORY_NAME String     @db.VarChar(255)
  PRODUCTS      PRODUCTS[]
}

model PRODUCTS {
  PRODUCT_ID         Int                 @id(map: "PK__PRODUCTS__52B417632D881038") @default(autoincrement())
  ITEM_ID            String              @db.VarChar(50)
  PRODUCT_NAME       String              @db.VarChar(255)
  CATEGORY_ID        Int
  UNIT_COST          Decimal?            @db.Decimal(18, 2)
  ORDER_UNIT         String?             @db.VarChar(50)
  PHOTO_URL          String?             @db.VarChar(500)
  CREATED_AT         DateTime?           @default(now(), map: "DF__PRODUCTS__CREATE__4316F928") @db.DateTime
  PRICE_HISTORY      PRICE_HISTORY[]
  PRODUCT_AUDIT_LOG  PRODUCT_AUDIT_LOG[]
  PRODUCT_CATEGORIES PRODUCT_CATEGORIES  @relation(fields: [CATEGORY_ID], references: [CATEGORY_ID], onUpdate: NoAction, map: "FK__PRODUCTS__CATEGO__440B1D61")
  REQUISITION_ITEMS  REQUISITION_ITEMS[]
}

model REQUISITION_ITEMS {
  ITEM_ID        Int          @id(map: "PK__REQUISIT__ADFD89A09D2ECDD5") @default(autoincrement())
  REQUISITION_ID Int
  PRODUCT_ID     Int
  QUANTITY       Int?
  UNIT_PRICE     Decimal?     @db.Decimal(18, 2)
  TOTAL_PRICE    Decimal?     @db.Decimal(29, 2)
  PRODUCTS       PRODUCTS     @relation(fields: [PRODUCT_ID], references: [PRODUCT_ID], onUpdate: NoAction, map: "FK__REQUISITI__PRODU__4CA06362")
  REQUISITIONS   REQUISITIONS @relation(fields: [REQUISITION_ID], references: [REQUISITION_ID], onUpdate: NoAction, map: "FK__REQUISITI__REQUI__4BAC3F29")
}

model REQUISITIONS {
  REQUISITION_ID    Int                 @id(map: "PK__REQUISIT__7CBC0C8417343B4A") @default(autoincrement())
  USER_ID           String              @db.VarChar(50)
  STATUS            String?             @db.VarChar(50)
  SUBMITTED_AT      DateTime?           @default(now(), map: "DF__REQUISITI__SUBMI__47DBAE45") @db.DateTime
  TOTAL_AMOUNT      Decimal?            @db.Decimal(18, 2)
  SITE_ID           String?             @db.VarChar(50)
  ISSUE_NOTE        String?             @db.VarChar(1000)
  ADMIN_VIEWED_AT   DateTime?           @db.DateTime
  APPROVALS         APPROVALS[]
  EXPORT_LOGS       EXPORT_LOGS[]
  REQUISITION_ITEMS REQUISITION_ITEMS[]
  USERS             USERS               @relation(fields: [USER_ID], references: [USER_ID], onUpdate: NoAction, map: "FK__REQUISITI__USER___48CFD27E")
  STATUS_HISTORY    STATUS_HISTORY[]
}

model STATUS_HISTORY {
  STATUS_ID      Int          @id(map: "PK__STATUS_H__D8827E71F8D80128") @default(autoincrement())
  REQUISITION_ID Int
  STATUS         String?      @db.VarChar(50)
  CHANGED_BY     String       @db.VarChar(50)
  CHANGED_AT     DateTime?    @default(now(), map: "DF__STATUS_HI__CHANG__5FB337D6") @db.DateTime
  COMMENT        String?      @db.VarChar(1000)
  USERS          USERS        @relation(fields: [CHANGED_BY], references: [USER_ID], onUpdate: NoAction, map: "FK__STATUS_HI__CHANG__619B8048")
  REQUISITIONS   REQUISITIONS @relation(fields: [REQUISITION_ID], references: [REQUISITION_ID], onUpdate: NoAction, map: "FK__STATUS_HI__REQUI__60A75C0F")
}

model USERS {
  USER_ID           String              @id(map: "PK__USERS__F3BEEBFF17F9F5BC") @db.VarChar(50)
  USERNAME          String              @db.VarChar(100)
  PASSWORD          String              @db.VarChar(255)
  EMAIL             String              @db.VarChar(255)
  ROLE              String?             @db.VarChar(50)
  DEPARTMENT        String?             @db.VarChar(100)
  SITE_ID           String?             @db.VarChar(50)
  CREATED_AT        DateTime?           @default(now(), map: "DF__USERS__CREATED_A__3F466844") @db.DateTime
  APPROVALS         APPROVALS[]
  EMAIL_LOGS        EMAIL_LOGS[]
  EXPORT_LOGS       EXPORT_LOGS[]
  PRODUCT_AUDIT_LOG PRODUCT_AUDIT_LOG[]
  REQUISITIONS      REQUISITIONS[]
  STATUS_HISTORY    STATUS_HISTORY[]
}

view UserWithRoles {
  AdLoginName    String? @db.VarChar(50)
  EmpCode        String? @db.VarChar(50)
  CurrentEmail   String? @db.VarChar(100)
  FullNameEng    String? @db.VarChar(100)
  FullNameThai   String? @db.VarChar(100)
  PostNameEng    String? @db.VarChar(100)
  CostCenterEng  String? @db.VarChar(100)
  OrgTDesc3      String? @db.VarChar(100)
  OrgCode3       String? @db.VarChar(100)
  supereng       String? @db.NVarChar(Max)
  superempcode   String? @db.NVarChar(Max)
  OrgCode4       String? @db.VarChar(100)
  OrgTDesc4      String? @db.VarChar(100)
  costcentercode String? @db.NVarChar(Max)
}

view VS_DivisionMgr {
  CostCenter   String? @db.NVarChar(10)
  L2           String? @db.NVarChar(10)
  CurrentEmail String? @db.VarChar(100)
  FullNameEng  String? @db.VarChar(100)
  PostNameEng  String? @db.VarChar(100)
  OrgCode3     String? @db.VarChar(100)
  OrgTDesc3    String? @db.VarChar(100)
  OrgCode4     String? @db.NVarChar(Max)
  OrgTDesc4    String? @db.NVarChar(Max)
}
